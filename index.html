<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Climb Recorder</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<center>
    <nav class="navMenu">
        <a href="index.html">Accueil</a>
        <a href="index.html#licencies">Licenciés</a>
        <a href="index.html#voies">Voies</a>
    </nav>
    <div class="separator"></div>
</center>


<div id="app" class="container">
    <h2 id="licencies">Liste des licenciés du club :</h2>

    <button id="afficherFormulaireLicencie" class="button-form">Ajouter une licence</button>

    <!-- Formulaire de création de licence -->
    <div id="formulaireContainerLicence" style="display: none;" class="form">
        <span id="fermerFormulaireLicence">&times;</span>
        <form id="formLicence" autocomplete="off">
            <!-- Contenu du formulaire -->
            <label for="nom">Nom :</label>
            <input type="text" id="nom" name="nom">
            <br>

            <label for="prenom">Prénom :</label>
            <input type="text" id="prenom" name="prenom">
            <br>

            <label for="numLicence">N° de licence FFME :</label>
            <input type="number" id="numLicence" name="numLicence">
            <br>

            <!-- Autres champs du formulaire -->
            <button type="button" onclick="ajouterLicence()" class="button-form">Ajouter</button>
            <p id="erreurLicence">Une erreur s'est produite, merci de réessayer.</p>
        </form>
    </div>

    <table class="table">
        <thead>
        <tr>
            <th>Identifiant</th>
            <th>Numéro licence FFME</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Initiateur</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="personne in personnes" :key="personne.idPersonne" v-on:click="selectPersonne(personne)">
            <td>{{ personne.idPersonne }}</td>
            <td v-if="personne.numLicence==null"><img src="noLicence.png" alt="personne.numLicence"></td>
            <td v-else>{{personne.numLicence}}</td>
            <td>{{ personne.nom }}</td>
            <td>{{ personne.prenom }}</td>
            <td><img v-bind:src="getInitiateurIcon(personne.estInitiateur)" alt="Initiateur"></td>
        </tr>
        </tbody>
    </table>
    <br>


    <h2 id="voies">Liste des voies du club :</h2>

    <button id="afficherFormulaireVoie" class="button-form">Ajouter une voie</button>
    <!-- Formulaire de création de voie -->
    <div id="formulaireContainerVoie" style="display: none;" class="form">
        <span id="fermerFormulaireVoie">&times;</span>
        <form id="formVoie" autocomplete="off">
            <!-- Contenu du formulaire -->
            <label for="secteur">Secteur :</label>
            <input type="number" id="secteur" name="secteur">
            <br>

            <label for="couleur">Couleur :</label>
            <input type="text" id="couleur" name="couleur">
            <br>

            <label for="difficulte">Difficulté :</label>
            <select id="difficulte" name="difficulte">
                <option value="4a">4a</option>
                <option value="4b">4b</option>
                <option value="4c">4c</option>
                <option value="5a">5a</option>
                <option value="5b">5b</option>
                <option value="5c">5c</option>
                <option value="6a">6a</option>
                <option value="6b">6b</option>
                <option value="6c">6c</option>
                <option value="7a">7a</option>
                <option value="7b">7b</option>
                <option value="7c+">7c & +</option>
            </select>
            <br>

            <label for="personnes">Ouvreur :</label>
            <select id="personnes" name="personnes">
                <!-- Les options seront ajoutées dynamiquement avec JavaScript -->
            </select>
            <br>

            <!-- Autres champs du formulaire -->
            <button type="button" onclick="ajouterVoie()" class="button-form">Ajouter</button>
            <p id="erreurVoie">Une erreur s'est produite, merci de réessayer.</p>
        </form>
    </div>

    <table class="table">
        <thead>
        <tr>
            <th>Identifiant</th>
            <th>Secteur</th>
            <th>Couleur</th>
            <th>Niveau</th>
            <th>Ouvreur</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="voie in voies" :key="voie.idVoie" v-on:click="selectVoie(voie)">
            <td>{{ voie.idVoie }}</td>
            <td>{{voie.secteur}}</td>
            <td>{{ voie.couleur }}</td>
            <td v-if="parseInt(voie.niveau.charAt(0))>6">{{ voie.niveau }}<span class="point"
                                                                                style="color: red; font-size: 60px">&#8226;</span>
            </td>
            <td v-if="[5,6].includes(parseInt(voie.niveau.charAt(0)))">{{ voie.niveau }}<span class="point"
                                                                                              style="color: orange; font-size: 60px">&#8226;</span>
            </td>
            <td v-if="parseInt(voie.niveau.charAt(0))<5">{{ voie.niveau }}<span class="point"
                                                                                style="color: limegreen; font-size: 60px">&#8226;</span>
            </td>
            <td>{{voie.prenom}} {{voie.nom}}</td>
        </tr>
        </tbody>
    </table>
</div>
<script src="script.js"></script>
<script>
    function chargerPersonnes() {
        fetch('http://localhost:3000/personnes')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                // Ajouter les options au menu déroulant
                var select = document.getElementById('personnes');
                data.forEach(function (personne) {
                    var option = document.createElement('option');
                    option.value = personne.idPersonne;
                    option.textContent = personne.prenom + ' ' + personne.nom;
                    select.appendChild(option);
                });
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    function ajouterVoie() {
        // Récupérer les valeurs des champs du formulaire
        var secteur = document.getElementById('secteur').value;
        var couleur = document.getElementById('couleur').value;
        var difficulte = document.getElementById('difficulte').value;
        var ouvreur = document.getElementById('personnes').value;

        if (secteur==="" || couleur==="" || difficulte==="" || ouvreur===""){
            erreurVoie.style.display = "block";
        }
        else{
            fetch(`http://localhost:3000/voies/add/${secteur}/${couleur}/${difficulte}/${ouvreur}`)
                .then(response => response.json())
                .then(data => {
                    window.location.href = "index.html";
                });
            erreurVoie.style.display = "none";
            window.location.href = "index.html";
        }
    }


    function ajouterLicence() {
        // Récupérer les valeurs des champs du formulaire
        var nom = document.getElementById('nom').value;
        var prenom = document.getElementById('prenom').value;
        var licence = document.getElementById('numLicence').value;

        if (nom==="" || prenom==="" || licence===""){
            erreurLicence.style.display = "block";
        }
        else{
            fetch(`http://localhost:3000/personnes/add/${licence}/${nom}/${prenom}`)
                .then(response => response.json())
                .then(data => {
                    window.location.href = "index.html";
                });
            erreurLicence.style.display = "none";
            window.location.href = "index.html";
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Charge la liste des personnes existantes lors du chargement de la page
        chargerPersonnes();
    });

    var fermerFormulaireVoieBtn = document.getElementById('fermerFormulaireVoie');
    var erreurVoie = document.getElementById("erreurVoie");
    var fermerFormulaireLicenceBtn = document.getElementById('fermerFormulaireLicence');
    var erreurLicence = document.getElementById("erreurLicence");
    var afficherFormulaireVoieBtn = document.getElementById('afficherFormulaireVoie');
    var formulaireContainerVoie = document.getElementById('formulaireContainerVoie');
    var afficherFormulaireLicenceBtn = document.getElementById('afficherFormulaireLicencie');
    var formulaireContainerLicence = document.getElementById('formulaireContainerLicence');

    // Fermeture des formulaires
    fermerFormulaireVoieBtn.addEventListener('click', function () {
        // Masquer le formulaire
        formulaireContainerVoie.style.display = 'none';
        erreurVoie.style.display = "none";
    });

    fermerFormulaireLicenceBtn.addEventListener('click', function () {
        // Masquer le formulaire
        formulaireContainerLicence.style.display = 'none';
        erreurLicence.style.display = "none";
    });

    // Ouverture des formulaires
    afficherFormulaireVoieBtn.addEventListener('click', function () {
        formulaireContainerLicence.style.display = 'none';
        erreurLicence.style.display = "none";
        formulaireContainerVoie.style.display = 'block';
    });

    afficherFormulaireLicenceBtn.addEventListener('click', function () {
        formulaireContainerVoie.style.display = 'none';
        erreurVoie.style.display = "none";
        formulaireContainerLicence.style.display = 'block';
    });

</script>
</body>
</html>
